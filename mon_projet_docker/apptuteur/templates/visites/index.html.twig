{% extends 'base.html.twig' %}

{% block title %}Visites de
	{{ etudiant.prenom }}
	{{ etudiant.nom }}
{% endblock %}

{% block body %}
	<div class="d-flex justify-content-between align-items-center mb-3">
		<div>
			<h1 class="h4 mb-1">Visites de
				{{ etudiant.prenom }}
				{{ etudiant.nom }}</h1>
			<p class="text-muted mb-0">Formation :
				{{ etudiant.formation }}</p>
		</div>
		<div class="d-flex gap-2">
			<a class="btn btn-secondary" href="{{ path('etudiants_index') }}">Retour</a>
			<a class="btn btn-primary" href="{{ path('visites_new', {id: etudiant.id}) }}">Ajouter une visite</a>
		</div>
	</div>

	<form method="get" class="row g-2 align-items-end mb-3">
		<div class="col-md-4">
			<label class="form-label" for="statut">Filtrer par statut</label>
			<select class="form-select" id="statut" name="statut">
				<option value="">Toutes</option>
				<option value="prévue" {% if statut == 'prévue' %} selected {% endif %}>Prévue</option>
				<option value="réalisée" {% if statut == 'réalisée' %} selected {% endif %}>Réalisée</option>
				<option value="annulée" {% if statut == 'annulée' %} selected {% endif %}>Annulée</option>
			</select>
		</div>
		<div class="col-md-3">
			<label class="form-label d-block">Trier par date</label>
			<input type="hidden" name="dir" value="{{ dir == 'DESC' ? 'DESC' : 'ASC' }}">
			<div class="btn-group" role="group">
				<button name="dir" value="ASC" class="btn btn-outline-secondary {{ dir != 'DESC' ? 'active' : '' }}">Trier ↑</button>
				<button name="dir" value="DESC" class="btn btn-outline-secondary {{ dir == 'DESC' ? 'active' : '' }}">Trier ↓</button>
			</div>
		</div>
		<div class="col-md-2 d-flex align-items-end">
			<button class="btn btn-outline-primary" type="submit">Appliquer</button>
		</div>
	</form>

	<div class="table-responsive">
		<table class="table table-striped align-middle">
			<thead>
				<tr>
					<th>Date</th>
					<th>Statut</th>
					<th>Commentaire</th>
					<th>Compte rendu</th>
					<th class="text-end">Actions</th>
				</tr>
			</thead>
			<tbody>
				{% for visite in visites %}
					<tr>
						<td>{{ visite.date|date('d/m/Y H:i') }}</td>
						<td>
							<span class="badge bg-info">{{ visite.statut|capitalize }}</span>
						</td>
						<td>{{ visite.commentaire }}</td>
						<td>{{ visite.compteRendu ? visite.compteRendu|slice(0,40) ~ '…' : '-' }}</td>
						<td class="text-end">
							<div class="btn-group" role="group">
								<a class="btn btn-outline-dark btn-sm" href="{{ path('visites_edit', {id: visite.id}) }}">Modifier</a>
								<a class="btn btn-outline-primary btn-sm" href="{{ path('visites_compte_rendu', {id: visite.id}) }}">Compte rendu</a>
								<a class="btn btn-outline-success btn-sm" href="{{ path('visites_compte_rendu', {id: visite.id, export: 'pdf'}) }}">PDF</a>
							</div>
						</td>
					</tr>
				{% else %}
					<tr>
						<td colspan="5">Aucune visite.</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
{% endblock %}
